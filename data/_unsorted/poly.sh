#!/bin/bash
# chicago region
CMD=$1
POLY="poly('41.93372979794396,-87.69238039507584,41.93138571629652,-87.6947392598301,41.92787018020761,-87.69709634626736,41.92611219095415,-87.69866833314789,41.92201069725349,-87.7018115952395,41.91966627419661,-87.70495683315468,41.91615029185551,-87.70809995187798,41.91497831728767,-87.70888491392341,41.912633814679,-87.7112414927649,41.90911743421828,-87.71438254102392,41.90618761086485,-87.71673835212054,41.90325788906588,-87.71909411885325,41.9009144057347,-87.72066432703045,41.8973988448862,-87.72380730934916,41.89446924341436,-87.72616398101857,41.89388368405346,-87.72616316542249,41.89095397904193,-87.72851923896,41.88685224469532,-87.73165929188116,41.88392228309966,-87.73401432579232,41.88040669198094,-87.73636812441723,41.87806220492696,-87.73872431344087,41.87572124625655,-87.73714790057963,41.87162510424631,-87.73399598021552,41.86752945740275,-87.73005796000564,41.86401788169051,-87.72769398752517,41.85816574822708,-87.72296821864448,41.85289884859733,-87.7182443901057,41.84821702356716,-87.71352266785718,41.84411991798451,-87.70958822104723,41.84119449660746,-87.70565417916254,41.83826928091235,-87.70171985276833,41.83592899488863,-87.69857267552305,41.83417363790316,-87.69621276815066,41.83183252839591,-87.69385250930492,41.82832067587462,-87.69070533911125,41.82539390506375,-87.68834491540899,41.8218813655493,-87.6859843082926,41.81953963865744,-87.68362526699173,41.81661225612534,-87.68048037597696,41.81368472827962,-87.67733572218124,41.81134303189474,-87.67497695140611,41.80958698700984,-87.67261867837996,41.80900227563137,-87.67026117054388,41.81134575332833,-87.66869096285009,41.81368977556233,-87.66554914540005,41.81544749119487,-87.66397837910532,41.81896352806285,-87.6584792934238,41.82072131382124,-87.65612248618417,41.82306469912236,-87.65376576745912,41.82657972299457,-87.6498374976197,41.82950869595101,-87.64669466867338,41.83009463990737,-87.64512300432055,41.83360919074319,-87.64119405149411,41.83595221516261,-87.63805059922365,41.83712359767009,-87.63569287885569,41.83946616709802,-87.63176316890451,41.84180858830469,-87.62783321885949,41.84356546470301,-87.62626112100469,41.84356617199686,-87.62233121645241,41.84356650134368,-87.61997336414416,41.84356488247783,-87.61289907344415,41.8435622891781,-87.60896787063957,41.84531497236078,-87.60503444173764,41.84765750291276,-87.60424748515364,41.85000002760636,-87.6042466018832,41.85234290932996,-87.60424589744827,41.85468549993833,-87.60424501075353,41.85819930273342,-87.60424368139509,41.86171311822153,-87.60424224965357,41.86405585247289,-87.60502774309305,41.86815547994618,-87.60581263138366,41.87166953871421,-87.60738426280685,41.8745976430577,-87.60738323068898,41.87694040407533,-87.60816893710508,41.87928280192065,-87.60816849841387,41.881625331024,-87.6089547791657,41.8833820638331,-87.60895452781443,41.88513890324992,-87.60974076070782,41.88923813677687,-87.61052610703125,41.89158105764405,-87.6113114478761,41.89392408587062,-87.6120969427334,41.89743716797641,-87.61288338318485,41.89978023436993,-87.61366908511131,41.9027086693811,-87.61602881244067,41.90388030614053,-87.61838903623885,41.90446587159931,-87.62153644515115,41.9056354111016,-87.62547081761527,41.90563507195324,-87.62861803048632,41.90622092722265,-87.63097840964538,41.907978260625,-87.63648638889703,41.90856398006277,-87.63884710191159,41.90914955993863,-87.64199478008143,41.90973360063008,-87.64671567343987,41.910903557525,-87.65064998521818,41.91148833635809,-87.65379749795541,41.91324411807357,-87.65694552855507,41.91441425670074,-87.66088049416339,41.91558454925708,-87.66481586365423,41.9155837123094,-87.66796365513326,41.91616838591737,-87.67111192211715,41.91733842431802,-87.67504784871413,41.92026542617067,-87.67819831639839,41.9226072966368,-87.67977438646614,41.92494910327159,-87.68135058876679,41.92787599542237,-87.68450173754795,41.92963167447502,-87.687652001785,41.93197389281489,-87.68922914485638,41.932559302187,-87.69001710272492,41.93372979794396,-87.69238039507584')"
QUERY1="q(x.b('location',region(22,$POLY)))"
QUERY2="q(x.b('location',region(22,poly_complement($POLY))))"
QUERY3="q(x.b('location',region(22,poly_union($POLY,poly_complement($POLY)))))"

if [ $CMD = "debug" ]; then
	gdb --args nanocube query "{$QUERY1;$QUERY2;$QUERY3}" x=chicago-crimes.nanocube
elif [ $CMD = "valgrind" ]; then
	valgrind nanocube query "{$QUERY1;$QUERY2;$QUERY3}" x=chicago-crimes.nanocube
else
	nanocube query "{$QUERY1;$QUERY2;$QUERY3}" x=chicago-crimes.nanocube
fi

# QUERY="nanocube query \"{q(x.b('location',region(22,$POLY)));q(x.b('location',region(22,poly_complement($POLY))))}\" x=chicago-crimes.nanocube"
# echo $QUERY > q

